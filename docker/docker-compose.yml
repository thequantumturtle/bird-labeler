services:
  dev:
    build:
      context: ..
      dockerfile: docker/Dockerfile
    working_dir: /workspace
    volumes:
      - ..:/workspace
      - hf-cache:/cache/hf
    environment:
      - BIRD_LABELER_CONFIG=/workspace/configs/default.yaml
      - HF_HOME=/cache/hf
      - HUGGINGFACE_HUB_CACHE=/cache/hf/hub
      - TRANSFORMERS_CACHE=/cache/hf/transformers
    command: bash
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu]

volumes:
  hf-cache:
